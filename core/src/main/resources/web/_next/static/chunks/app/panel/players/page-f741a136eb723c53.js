(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8130],{14396:(e,s,t)=>{"use strict";t.d(s,{h:()=>a});var r=t(12115);function a(e){for(var s=arguments.length,t=Array(s>1?s-1:0),a=1;a<s;a++)t[a-1]=arguments[a];let[i,n]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let s=new e(...t);return n(e=>null!=e?e:s),()=>{s.close(),n(null)}},[e]),i}},16103:(e,s,t)=>{"use strict";t.d(s,{B6:()=>o,CB:()=>y,EW:()=>x,HQ:()=>c,Hy:()=>l,Q4:()=>p,_L:()=>d,lE:()=>m,wx:()=>u,zf:()=>h});var r=t(56671),a=t(31886),i=t(53999),n=t(80154);async function l(e){let s=!(arguments.length>1)||void 0===arguments[1]||arguments[1];try{await (0,a.ow)("/api/players/op?uuid=".concat(e)),s&&r.toast.success((0,n.$)("players.action.op.success"))}catch(e){(0,a.Kf)(e,(0,n.$)("players.action.op.error"),[[400,(0,n.$)("common.error.400")],[401,(0,n.$)("common.error.401")],[404,(0,n.$)("players.action.op.error.404")]])}}async function o(e){let s=!(arguments.length>1)||void 0===arguments[1]||arguments[1];try{await (0,a.ow)("/api/players/deop?uuid=".concat(e)),s&&r.toast.success((0,n.$)("players.action.deop.success"))}catch(e){(0,a.Kf)(e,(0,n.$)("players.action.deop.error"),[[400,(0,n.$)("common.error.400")],[401,(0,n.$)("common.error.401")],[404,(0,n.$)("players.action.deop.error.404")]])}}async function c(e,s){let t=!(arguments.length>2)||void 0===arguments[2]||arguments[2];try{await (0,a.ow)("/api/players/kick?uuid=".concat(e,"&r=").concat(s?(0,i.q3)(s):"")),t&&r.toast.success((0,n.$)("players.action.kick.success"))}catch(e){(0,a.Kf)(e,(0,n.$)("players.action.kick.error"),[[400,(0,n.$)("common.error.400")],[401,(0,n.$)("common.error.401")],[403,(0,n.$)("players.action.kick.error.403")],[404,(0,n.$)("players.action.kick.error.404")]])}}async function d(e,s){let t=!(arguments.length>2)||void 0===arguments[2]||arguments[2];try{await (0,a.ow)("/api/players/ban?uuid=".concat(e,"&r=").concat(s?(0,i.q3)(s):"")),t&&r.toast.success((0,n.$)("players.action.ban.success"))}catch(e){(0,a.Kf)(e,(0,n.$)("players.action.ban.error"),[[400,(0,n.$)("common.error.400")],[401,(0,n.$)("common.error.401")],[404,(0,n.$)("players.action.ban.error.404")]])}}async function h(e){let s=!(arguments.length>1)||void 0===arguments[1]||arguments[1];try{await (0,a.ow)("/api/players/pardon?uuid=".concat(e)),s&&r.toast.success((0,n.$)("players.action.pardon.success"))}catch(e){(0,a.Kf)(e,(0,n.$)("players.action.pardon.error"),[[400,(0,n.$)("common.error.400")],[401,(0,n.$)("common.error.401")],[404,(0,n.$)("players.action.pardon.error.404")]])}}async function p(e,s){let t=!(arguments.length>2)||void 0===arguments[2]||arguments[2];try{await (0,a.ow)("/api/players/gamemode?uuid=".concat(e,"&gm=").concat(s)),t&&r.toast.success((0,n.$)("players.action.set-gamemode.success",(0,i.Cq)(s)))}catch(e){(0,a.Kf)(e,(0,n.$)("players.action.set-gamemode.error"),[[400,(0,n.$)("common.error.400")],[401,(0,n.$)("common.error.401")],[404,(0,n.$)("players.action.set-gamemode.error.404")]])}}async function u(e){let s=!(arguments.length>1)||void 0===arguments[1]||arguments[1];try{await (0,a.nl)("/api/players?uuid=".concat(e)),s&&r.toast.success((0,n.$)("players.action.remove.success"))}catch(e){(0,a.Kf)(e,(0,n.$)("players.action.remove.error"),[[400,(0,n.$)("common.error.400")],[401,(0,n.$)("common.error.401")],[404,(0,n.$)("players.action.remove.error.404")],[500,(0,n.$)("common.error.500")]])}}async function m(e){let s=!(arguments.length>1)||void 0===arguments[1]||arguments[1];try{await (0,a.ow)("/api/whitelist/".concat(e?"enable":"disable")),s&&r.toast.success(e?(0,n.$)("players.enable-whitelist.success"):(0,n.$)("players.disable-whitelist.success"))}catch(s){(0,a.Kf)(s,e?(0,n.$)("players.enable-whitelist.error"):(0,n.$)("players.disable-whitelist.error"),[[401,"未登录"],[500,"服务器内部错误"]])}}async function x(e,s){let t=!(arguments.length>2)||void 0===arguments[2]||arguments[2];try{await (0,a.ow)("/api/whitelist/add?name=".concat(e,"&uuid=").concat(s)),t&&r.toast.success((0,n.$)("players.action.add-to-whitelist.success"))}catch(e){(0,a.Kf)(e,(0,n.$)("players.action.add-to-whitelist.error"),[[400,(0,n.$)("common.error.400")],[401,(0,n.$)("common.error.401")],[500,(0,n.$)("common.error.500")]])}}async function y(e,s){let t=!(arguments.length>2)||void 0===arguments[2]||arguments[2];try{await (0,a.ow)("/api/whitelist/remove?name=".concat(e,"&uuid=").concat(s)),t&&r.toast.success((0,n.$)("players.action.remove-from-whitelist.success"))}catch(e){(0,a.Kf)(e,(0,n.$)("players.action.remove-from-whitelist.error"),[[400,(0,n.$)("common.error.400")],[401,(0,n.$)("common.error.401")],[500,(0,n.$)("common.error.500")]])}}},18639:(e,s,t)=>{"use strict";t.d(s,{r:()=>l});var r=t(16453),a=t(56671),i=t(31886),n=t(80154);class l{init(){this.socket&&(this.socket.addEventListener("open",()=>{this.send("auth",(0,r.getCookie)("token"))}),this.subscribe("connect",()=>{this.onOpen(),this.send("ping",null)}),this.subscribe("pong",()=>{this.heartbeatTimer=setTimeout(()=>{this.send("ping",null)},2e4)}),this.subscribe("error",e=>{this.onError(e)}),this.socket.addEventListener("error",e=>{this.onError(e),a.toast.error((0,n.$)("terminal.ws.error"))}),this.socket.addEventListener("close",()=>{this.onClose()}))}subscribe(e,s){if(!this.socket)return void a.toast.error("WebSocket not initialized.");this.socket.addEventListener("message",t=>{let r=JSON.parse(t.data);r.type===e&&s(r.data)})}send(e,s){if(!this.socket)return void a.toast.error("WebSocket not initialized.");this.socket.send(JSON.stringify({type:e,data:s}))}close(){this.heartbeatTimer&&clearTimeout(this.heartbeatTimer),this.socket&&(this.socket.close(),this.socket=null)}constructor(e){this.socket=null,this.heartbeatTimer=null,(0,r.hasCookie)("token")||(window.location.href="/login");let s=new URL(i.yq);s.pathname=e,this.socket=new WebSocket(s),this.init()}}},31035:(e,s,t)=>{"use strict";t.d(s,{I:()=>i,v:()=>a});function r(e){return e<10?"0".concat(e):e.toString()}function a(e){let s=Math.floor(e/36e5),t=Math.floor((e-=36e5*s)/6e4),a=Math.floor((e-=6e4*t)/1e3);return"".concat(r(s),":").concat(r(t),":").concat(r(a))}function i(e){let s=Math.floor(e/1e3+6)%24,t=Math.floor(e%1e3/16.6);return"".concat(r(s),":").concat(r(t))}},34685:(e,s,t)=>{"use strict";t.d(s,{y:()=>n});var r=t(56671),a=t(18639),i=t(80154);class n extends a.r{onOpen(){console.log("Player list connected.")}onClose(){console.log("Player list disconnected.")}onError(e){console.log("Player list connection failed. ",e),r.toast.error((0,i.$)("players.ws.error"))}constructor(){super("/socket/players")}}},53571:(e,s,t)=>{Promise.resolve().then(t.bind(t,94167))},86801:(e,s,t)=>{"use strict";t.d(s,{T:()=>y});var r=t(95155),a=t(55028),i=t(12115),n=t(51362),l=t(56671),o=t(41085),c=t(97168),d=t(31886),h=t(16103),p=t(52815),u=t(80154),m=t(6937);let x=(0,a.default)(()=>Promise.all([t.e(4654),t.e(1376),t.e(6859),t.e(8638),t.e(4695),t.e(2674),t.e(1752)]).then(t.bind(t,11752)),{loadableGenerated:{webpack:()=>[11752]},ssr:!1});function y(e){let{onDisableWhitelist:s,children:t,asChild:a}=e,[y,f]=(0,i.useState)(""),{theme:j}=(0,n.D)(),v=async()=>{try{let e=await (0,d.qV)("/api/whitelist");f(JSON.stringify(e.whitelist,void 0,2))}catch(e){(0,d.Kf)(e,"无法获取白名单",[[401,"未登录"],[500,"服务器内部错误"]])}},g=async()=>{try{await (0,d.ow)("/api/whitelist/write",JSON.parse(y)),l.toast.success("保存成功")}catch(e){(0,d.Kf)(e,"无法保存白名单",[[401,"未登录"],[500,"服务器内部错误"]])}};return(0,r.jsxs)(o.cj,{onOpenChange:e=>e&&v(),children:[(0,r.jsx)(o.CG,{asChild:a,children:t}),(0,r.jsxs)(o.h,{children:[(0,r.jsxs)(o.Fm,{children:[(0,r.jsx)(o.qp,{children:(0,u.$)("players.edit-whitelist.title")}),(0,r.jsx)(o.Qs,{children:(0,r.jsx)(m.E,{id:"players.edit-whitelist.description",args:[(0,r.jsx)("code",{children:"whitelist.json"},0)]})})]}),(0,r.jsx)("div",{className:"flex flex-col h-full",children:y&&(0,r.jsx)(x,{defaultLanguage:"json",value:y,theme:"dark"===j?"vs-dark":"vs",options:{minimap:{enabled:!1},automaticLayout:!0,tabSize:2,...p.FN},onChange:e=>f(null!=e?e:"")})}),(0,r.jsxs)(o.XW,{children:[(0,r.jsx)(c.$,{variant:"destructive",className:"cursor-pointer",onClick:async()=>{await (0,h.lE)(!1),s&&s()},children:(0,u.$)("players.disable-whitelist")}),(0,r.jsx)(o.kN,{asChild:!0,children:(0,r.jsx)(c.$,{className:"cursor-pointer",onClick:()=>g(),children:(0,u.$)("dialog.save")})})]})]})]})}},94167:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>eo});var r=t(95155),a=t(12115),i=t(17580),n=t(32568),l=t(47924),o=t(6877),c=t(17881),d=t(42996),h=t(34964),p=t(22726),u=t(31886),m=t(6874),x=t.n(m),y=t(5196),f=t(75494),j=t(12318),v=t(81962),g=t(97092),$=t(74126),b=t(28113),w=t(53999),k=t(37777),N=t(97168),C=t(99840),z=t(82714),A=t(89852),O=t(80154);function P(e){let{title:s,description:t,label:i,placeholder:n,onAction:l,asChild:o,children:c}=e,d=(0,a.useRef)(null);return(0,r.jsxs)(C.lG,{children:[(0,r.jsx)(C.zM,{asChild:o,children:c}),(0,r.jsxs)(C.Cf,{children:[(0,r.jsxs)(C.c7,{children:[(0,r.jsx)(C.L3,{children:s}),t&&(0,r.jsx)(C.rr,{children:t})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,r.jsx)(z.J,{children:i}),(0,r.jsx)(A.p,{placeholder:n,ref:d})]}),(0,r.jsxs)(C.Es,{children:[(0,r.jsx)(C.HM,{asChild:!0,children:(0,r.jsx)(N.$,{variant:"outline",children:(0,O.$)("dialog.cancel")})}),(0,r.jsx)(C.HM,{asChild:!0,children:(0,r.jsx)(N.$,{onClick:()=>{d.current&&l&&l(d.current.value)},children:(0,O.$)("dialog.confirm")})})]})]})]})}var E=t(88145);function K(e){let{isOnline:s,className:t}=e;return(0,r.jsxs)(E.E,{variant:"outline",children:[(0,r.jsx)("div",{className:(0,w.cn)("w-2 h-2 rounded-full",s?"bg-green-600":"bg-muted-foreground",t)}),s?(0,O.$)("online-badge.online"):(0,O.$)("online-badge.offline")]})}var L=t(16103),S=t(62177),M=t(48778),_=t(71153),W=t(41085),q=t(30070),I=t(23291),T=t(91503),V=t(52815);function F(e){let{uuid:s}=e,t=(0,a.useRef)(null);return(0,a.useEffect)(()=>{t.current&&new T.A({canvas:t.current,skin:(0,V.mt)("players.skin-provider")+s,cape:(0,V.mt)("players.cape-provider")+s})},[s]),(0,r.jsx)("canvas",{ref:t})}var H=t(95784),R=t(90088),B=t(19832),Q=t(31035);let J=_.z.object({gamemode:_.z.enum(Object.values(I.UZ)),isOp:_.z.boolean()});function G(e){var s;let{player:t,children:i,asChild:n}=e,[l,c]=(0,a.useState)(t.joinTime?Date.now()-t.joinTime:null),d=(0,a.useRef)(null),h=(0,S.mN)({resolver:(0,M.u)(J),values:{gamemode:null!=(s=t.gamemode)?s:"adventure",isOp:t.isOp}}),p=async e=>{e.gamemode!==t.gamemode&&await (0,L.Q4)(t.uuid,e.gamemode,!1),e.isOp!==t.isOp&&(t.isOp?await (0,L.B6)(t.uuid,!1):await (0,L.Hy)(t.uuid,!1)),B.P.emit("refresh-data")};return(0,a.useEffect)(()=>{if(t.isOnline)return d.current=setInterval(()=>{c(e=>t.joinTime&&e?e+1e3:null)},1e3),()=>{d.current&&clearInterval(d.current)}},[t]),(0,r.jsxs)(W.cj,{children:[(0,r.jsx)(W.CG,{asChild:n,children:i}),(0,r.jsx)(W.h,{children:(0,r.jsx)(q.lV,{...h,children:(0,r.jsxs)("form",{className:"flex-1 flex flex-col",onSubmit:h.handleSubmit(p),children:[(0,r.jsxs)(W.Fm,{children:[(0,r.jsx)(W.qp,{children:(0,O.$)("players.edit.title")}),(0,r.jsx)(W.Qs,{children:(0,O.$)("players.edit.description")})]}),(0,r.jsxs)("div",{className:"flex-1 px-4 flex flex-col gap-5",children:[(0,r.jsx)(F,{uuid:t.uuid}),(0,r.jsxs)("div",{className:"flex justify-center items-center gap-2",children:[(0,r.jsx)(K,{isOnline:t.isOnline}),t.name?(0,r.jsx)("h2",{className:"inline-block text-lg font-semibold",children:t.name}):(0,r.jsxs)("span",{className:"text-muted-foreground italic",children:["<",(0,O.$)("players.unnamed"),">"]})]}),t.isOnline&&(0,r.jsxs)("div",{className:"flex flex-col gap-3",children:[t.ip&&(0,r.jsxs)(q.eI,{className:"flex justify-between",children:[(0,r.jsx)(q.lR,{children:(0,O.$)("players.edit.form.ip")}),(0,r.jsx)("span",{className:"text-sm",children:t.ip})]}),(0,r.jsxs)(q.eI,{className:"flex justify-between",children:[(0,r.jsx)(q.lR,{children:(0,O.$)("players.edit.form.online-time")}),(0,r.jsx)("span",{className:"text-sm",children:(0,Q.v)(null!=l?l:0)})]})]}),(0,r.jsx)(q.zB,{control:h.control,name:"gamemode",render:e=>{let{field:s}=e;return(0,r.jsxs)(q.eI,{children:[(0,r.jsx)(q.lR,{children:(0,O.$)("players.edit.form.gamemode.label")}),(0,r.jsx)(q.MJ,{children:(0,r.jsxs)(H.l6,{...s,onValueChange:s.onChange,children:[(0,r.jsx)(H.bq,{className:"w-full",children:(0,r.jsx)(H.yv,{})}),(0,r.jsxs)(H.gC,{children:[(0,r.jsx)(H.eb,{value:"adventure",children:(0,O.$)("common.gamemode.adventure")}),(0,r.jsx)(H.eb,{value:"survival",children:(0,O.$)("common.gamemode.survival")}),(0,r.jsx)(H.eb,{value:"creative",children:(0,O.$)("common.gamemode.creative")}),(0,r.jsx)(H.eb,{value:"spectator",children:(0,O.$)("common.gamemode.spectator")})]})]})}),(0,r.jsx)(q.C5,{})]})}}),(0,r.jsx)(q.zB,{control:h.control,name:"isOp",render:e=>{let{field:s}=e;return(0,r.jsxs)(q.eI,{className:"flex justify-between",children:[(0,r.jsx)(q.lR,{children:(0,O.$)("players.edit.form.op.label")}),(0,r.jsx)(q.MJ,{children:(0,r.jsx)(R.d,{...s,value:"",defaultChecked:t.isOp,onCheckedChange:s.onChange})}),(0,r.jsx)(q.C5,{})]})}}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)(z.J,{children:(0,O.$)("players.edit.form.manage")}),(0,r.jsxs)("div",{className:"grid grid-rows-2 grid-cols-2 gap-2 [&>*]:cursor-pointer",children:[t.name&&void 0!==t.isWhitelisted&&(t.isWhitelisted?(0,r.jsxs)(N.$,{variant:"outline",onClick:async()=>{await (0,L.CB)(t.name,t.uuid),B.P.emit("refresh-data")},children:[(0,r.jsx)(f.A,{}),(0,O.$)("players.action.remove-from-whitelist")]}):(0,r.jsxs)(N.$,{variant:"outline",onClick:async()=>{await (0,L.EW)(t.name,t.uuid),B.P.emit("refresh-data")},children:[(0,r.jsx)(j.A,{}),(0,O.$)("players.action.add-to-whitelist")]})),(0,r.jsx)(P,{title:(0,O.$)("players.action.kick.prompt.title"),description:(0,O.$)("players.action.kick.prompt.description"),label:(0,O.$)("players.action.kick.prompt.label"),placeholder:(0,O.$)("players.action.kick.prompt.placeholder"),onAction:async e=>{await (0,L.HQ)(t.uuid,e),B.P.emit("refresh-data")},asChild:!0,children:(0,r.jsxs)(N.$,{variant:"outline",className:void 0===t.isWhitelisted?"col-start-1":"col-start-2",disabled:!t.isOnline,children:[(0,r.jsx)(g.A,{}),(0,O.$)("players.action.kick")]})}),t.isBanned?(0,r.jsxs)(N.$,{variant:"outline",className:void 0===t.isWhitelisted?"col-start-2":"col-span-2",onClick:async()=>{await (0,L.zf)(t.uuid),B.P.emit("refresh-data")},children:[(0,r.jsx)(b.A,{}),(0,O.$)("players.action.pardon")]}):(0,r.jsx)(P,{title:(0,O.$)("players.action.ban.prompt.title"),description:(0,O.$)("players.action.ban.prompt.description"),label:(0,O.$)("players.action.ban.prompt.label"),placeholder:(0,O.$)("players.action.ban.prompt.placeholder"),onAction:async e=>{await (0,L._L)(t.uuid,e),B.P.emit("refresh-data")},asChild:!0,children:(0,r.jsxs)(N.$,{variant:"destructive",className:void 0===t.isWhitelisted?"col-start-2":"col-span-2",children:[(0,r.jsx)(o.A,{}),(0,O.$)("players.action.ban")]})})]})]})]}),(0,r.jsxs)(W.XW,{children:[(0,r.jsx)(W.kN,{asChild:!0,children:(0,r.jsx)(N.$,{type:"submit",className:"cursor-pointer",children:(0,O.$)("dialog.confirm")})}),(0,r.jsx)(W.kN,{asChild:!0,children:(0,r.jsx)(N.$,{variant:"outline",className:"cursor-pointer",children:(0,O.$)("dialog.cancel")})})]})]})})})]})}var U=t(99211);let X=[{accessorKey:"name",header:(0,O.$)("players.player-list.columns.name"),cell:e=>{let{row:s}=e,{name:t,uuid:a}=s.original;return(0,r.jsxs)(k.m_,{children:[(0,r.jsx)(k.k$,{children:(0,r.jsx)(G,{player:s.original,asChild:!0,children:t?(0,r.jsxs)("div",{className:"flex items-center gap-2 cursor-pointer",children:[(0,r.jsx)("img",{src:(0,V.mt)("players.avatar-provider")+a,alt:t,width:17,height:17}),(0,r.jsx)("span",{className:"font-semibold",children:t})]}):(0,r.jsxs)("span",{className:"text-muted-foreground italic cursor-pointer",children:["<",(0,O.$)("players.unnamed"),">"]})})}),(0,r.jsx)(k.ZI,{children:a})]})}},{accessorKey:"isOnline",header:()=>(0,r.jsx)("div",{className:"text-center",children:(0,O.$)("players.player-list.columns.is-online")}),cell:e=>{let{row:s}=e,{isOnline:t}=s.original;return(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)(K,{isOnline:t})})}},{accessorKey:"uuid",header:"",cell:""},{accessorKey:"gamemode",header:()=>(0,r.jsx)("div",{className:"text-center",children:(0,O.$)("players.player-list.columns.gamemode")}),cell:e=>{let{row:s}=e,{gamemode:t}=s.original;return t?(0,r.jsx)("div",{className:"text-center",children:(0,w.Cq)(t)}):(0,r.jsx)(r.Fragment,{})}},{accessorKey:"isWhitelisted",header:()=>(0,r.jsx)("div",{className:"text-center",children:(0,O.$)("players.player-list.columns.is-whitelisted")}),cell:e=>{let{row:s,column:t}=e;return(0,a.useEffect)(()=>{t.toggleVisibility(void 0!==s.original.isWhitelisted)},[s,t]),(0,r.jsx)("div",{className:"flex justify-center",children:s.original.isWhitelisted?(0,r.jsx)(y.A,{size:18,color:"var(--color-muted-foreground)"}):(0,r.jsx)(r.Fragment,{})})}},{accessorKey:"isOp",header:()=>(0,r.jsx)("div",{className:"text-center",children:"OP"}),cell:e=>{let{row:s}=e;return(0,r.jsx)("div",{className:"flex justify-center",children:s.original.isOp?(0,r.jsx)(y.A,{size:18,color:"var(--color-muted-foreground)"}):(0,r.jsx)(r.Fragment,{})})}},{header:" ",cell:e=>{let{row:s}=e,{name:t,uuid:a,isOnline:i,isWhitelisted:n}=s.original;return(0,r.jsxs)("div",{className:"flex justify-end [&>*]:h-4 [&>*]:cursor-pointer [&>*]:hover:!bg-transparent",children:[void 0!==n&&(n?(0,r.jsx)(N.$,{variant:"ghost",size:"icon",title:(0,O.$)("players.action.remove-from-whitelist"),onClick:async()=>{await (0,L.CB)(t,a),B.P.emit("refresh-data")},children:(0,r.jsx)(f.A,{})}):(0,r.jsx)(N.$,{variant:"ghost",size:"icon",title:(0,O.$)("players.action.add-to-whitelist"),onClick:async()=>{await (0,L.EW)(t,a),B.P.emit("refresh-data")},children:(0,r.jsx)(j.A,{})})),(0,r.jsx)(N.$,{variant:"ghost",size:"icon",title:(0,O.$)("players.action.edit-inventory"),asChild:!0,children:(0,r.jsx)(x(),{href:"/panel/players/inventory?uuid=".concat(a),children:(0,r.jsx)(v.A,{})})}),(0,r.jsx)(P,{title:(0,O.$)("players.action.kick.prompt.title"),description:(0,O.$)("players.action.kick.prompt.description"),label:(0,O.$)("players.action.kick.prompt.label"),placeholder:(0,O.$)("players.action.kick.prompt.placeholder"),onAction:async e=>{await (0,L.HQ)(a,e),B.P.emit("refresh-data")},asChild:!0,children:(0,r.jsx)(N.$,{variant:"ghost",size:"icon",disabled:!i,title:(0,O.$)("players.action.kick"),children:(0,r.jsx)(g.A,{})})}),(0,r.jsx)(P,{title:(0,O.$)("players.action.ban.prompt.title"),description:(0,O.$)("players.action.ban.prompt.description"),label:(0,O.$)("players.action.ban.prompt.label"),placeholder:(0,O.$)("players.action.ban.prompt.placeholder"),onAction:async e=>{await (0,L._L)(a,e),B.P.emit("refresh-data")},asChild:!0,children:(0,r.jsx)(N.$,{variant:"ghost",size:"icon",title:(0,O.$)("players.action.ban"),children:(0,r.jsx)(o.A,{className:"stroke-red-400"})})}),(0,r.jsx)(U.F,{title:(0,O.$)("players.action.remove.alert.title",t),description:i?(0,O.$)("players.action.remove.alert.description2"):(0,O.$)("players.action.remove.alert.description1"),onAction:async()=>{i&&(await (0,L.HQ)(a,(0,O.$)("players.action.remove.kick-reason"),!1),await (0,w.yy)(100)),await (0,L.wx)(a),B.P.emit("refresh-data")},asChild:!0,children:(0,r.jsx)(N.$,{variant:"ghost",size:"icon",title:(0,O.$)("players.action.remove"),children:(0,r.jsx)($.A,{className:"stroke-red-400"})})})]})}}],D=[{accessorKey:"name",header:(0,O.$)("players.banned-list.columns.name"),cell:e=>{let{row:s}=e,{name:t,uuid:a}=s.original;return(0,r.jsxs)(k.m_,{children:[(0,r.jsx)(k.k$,{children:(0,r.jsx)(G,{player:s.original,asChild:!0,children:(0,r.jsxs)("div",{className:"flex items-center gap-2 cursor-pointer",children:[(0,r.jsx)("img",{src:(0,V.mt)("players.avatar-provider")+a,alt:t,width:17,height:17}),(0,r.jsx)("span",{className:"font-semibold",children:t})]})})}),(0,r.jsx)(k.ZI,{children:a})]})}},{accessorKey:"banReason",header:(0,O.$)("players.banned-list.columns.ban-reason"),cell:e=>{let{row:s}=e,{banReason:t}=s.original;return t&&(0,r.jsx)("span",{children:(0,w.QM)(t)})}},{accessorKey:"uuid",header:"",cell:""},{accessorKey:"isOp",header:()=>(0,r.jsx)("div",{className:"text-center",children:"OP"}),cell:e=>{let{row:s}=e;return(0,r.jsx)("div",{className:"flex justify-center",children:s.original.isOp?(0,r.jsx)(y.A,{size:18,color:"var(--color-muted-foreground)"}):(0,r.jsx)(r.Fragment,{})})}},{header:" ",cell:e=>{let{row:s}=e;return(0,r.jsx)(N.$,{variant:"ghost",size:"icon",className:"float-right h-4 cursor-pointer hover:!bg-transparent",title:(0,O.$)("players.action.pardon"),onClick:async()=>{await (0,L.zf)(s.original.uuid),B.P.emit("refresh-data")},children:(0,r.jsx)(b.A,{className:"stroke-green-600"})})}}];var Z=t(20848),Y=t(86801),ee=t(28042),es=t(84616),et=t(56671),er=t(88524);function ea(e){let{children:s,asChild:t}=e,[i,n]=(0,a.useState)(!1),[l,o]=(0,a.useState)([]),[c,d]=(0,a.useState)(""),h=async()=>{try{let e=await (0,u.qV)("/api/banned-ips");o(e.bannedIps)}catch(e){(0,u.Kf)(e,(0,O.$)("players.banned-ips.fetch.error"),[[400,(0,O.$)("common.error.400")],[401,(0,O.$)("common.error.401")]])}},p=async e=>{if(""===e||!(0,w.NU)(e))return void et.toast.error((0,O.$)("players.banned-ips.add.error"),{description:(0,O.$)("players.banned-ips.add.error.400")});if(l.includes(e))return void et.toast.warning((0,O.$)("players.banned-ips.add.exist"));try{await (0,u.ow)("/api/banned-ips/add?ip=".concat(e)),d(""),B.P.emit("refresh-data"),et.toast.success((0,O.$)("players.banned-ips.add.success"))}catch(e){(0,u.Kf)(e,(0,O.$)("players.banned-ips.add.error"),[[400,(0,O.$)("players.banned-ips.add.error.400")],[401,(0,O.$)("common.error.401")]])}},m=async e=>{try{await (0,u.ow)("/api/banned-ips/remove?ip=".concat(e)),B.P.emit("refresh-data"),et.toast.success((0,O.$)("players.banned-ips.pardon.success"))}catch(e){(0,u.Kf)(e,(0,O.$)("players.banned-ips.pardon.error"),[[400,(0,O.$)("players.banned-ips.pardon.error.400")],[401,(0,O.$)("common.error.401")]])}};return(0,a.useEffect)(()=>(B.P.on("refresh-data",()=>h()),()=>{B.P.removeAllListeners("refresh-data")}),[]),(0,a.useEffect)(()=>{i?h():d("")},[i]),(0,r.jsxs)(C.lG,{open:i,onOpenChange:n,children:[(0,r.jsx)(C.zM,{asChild:t,children:s}),(0,r.jsxs)(C.Cf,{children:[(0,r.jsxs)(C.c7,{children:[(0,r.jsx)(C.L3,{children:(0,O.$)("players.banned-ips.title")}),(0,r.jsx)(C.rr,{children:(0,O.$)("players.banned-ips.description")})]}),(0,r.jsxs)("div",{className:"border rounded-md",children:[(0,r.jsx)("div",{className:"max-h-64 overflow-y-auto o-scrollbar",children:(0,r.jsx)(er.XI,{children:(0,r.jsx)(er.BF,{children:l.map((e,s)=>(0,r.jsxs)(er.Hj,{children:[(0,r.jsx)(er.nA,{children:e}),(0,r.jsx)(er.nA,{children:(0,r.jsx)(N.$,{variant:"ghost",size:"icon",className:"float-right h-4 cursor-pointer hover:!bg-transparent",title:(0,O.$)("players.banned-ips.pardon"),onClick:()=>m(e),children:(0,r.jsx)(b.A,{className:"stroke-green-600"})})})]},s))})})}),(0,r.jsxs)("div",{className:(0,w.cn)("flex gap-2 p-2",l.length>0&&"border-t"),children:[(0,r.jsx)(A.p,{value:c,placeholder:(0,O.$)("players.banned-ips.input.placeholder"),className:"h-8 rounded-sm",onInput:e=>d(e.target.value),onKeyDown:e=>"Enter"===e.key&&c.length>0&&p(c)}),(0,r.jsx)(N.$,{variant:"ghost",size:"icon-sm",className:"cursor-pointer",disabled:0===c.length,onClick:()=>p(c),children:(0,r.jsx)(es.A,{})})]})]}),(0,r.jsx)(C.Es,{children:(0,r.jsx)(C.HM,{asChild:!0,children:(0,r.jsx)(N.$,{variant:"outline",children:(0,O.$)("dialog.close")})})})]})]})}var ei=t(34685),en=t(14396),el=t(41236);function eo(){let[e,s]=(0,a.useState)([]),[t,m]=(0,a.useState)([]),[x,y]=(0,a.useState)(0),[f,j]=(0,a.useState)(!1),[v,g]=(0,a.useState)((0,V.mt)("state.players.tab")),[$,b]=(0,a.useState)(""),w=(0,a.useMemo)(()=>e.sort((e,s)=>e.name.localeCompare(s.name)),[e]),k=(0,a.useMemo)(()=>w.filter(e=>{let{isBanned:s}=e;return!s}),[w]),C=(0,a.useMemo)(()=>w.filter(e=>{let{isBanned:s}=e;return s}),[w]),z=(0,en.h)(ei.y),A=async()=>{try{let e=await (0,u.qV)("/api/players");y(e.maxPlayerCount),j(e.whitelist)}catch(e){(0,u.Kf)(e,(0,O.$)("players.error"),[[400,(0,O.$)("common.error.400")],[401,(0,O.$)("common.error.401")]])}};return(0,a.useEffect)(()=>(A(),B.P.on("refresh-data",()=>A()),()=>{B.P.removeAllListeners("refresh-data")}),[]),(0,a.useEffect)(()=>{if(z)return z.subscribe("init",e=>{s(e.filter(e=>{let{name:s}=e;return void 0!==s})),m(e.filter(e=>{let{name:s}=e;return void 0===s}))}),z.subscribe("join",e=>{s(s=>{let t=s.findIndex(s=>s.uuid===e.uuid);return t>-1?s.map((s,r)=>r===t?e:s):[...s,e]})}),z.subscribe("leave",e=>{s(s=>s.map(s=>s.uuid===e.uuid?e:s))}),z.subscribe("gamemode-change",e=>{s(s=>s.map(s=>s.uuid===e.uuid?e:s))}),B.P.on("refresh-data",()=>z.send("fetch",null)),()=>{B.P.removeAllListeners("refresh-data")}},[z]),(0,el.V)("ArrowRight",{ctrl:!0},()=>g("banned-list")),(0,el.V)("ArrowLeft",{ctrl:!0},()=>g("player-list")),(0,r.jsxs)(Z.C,{title:(0,O.$)("players.title"),subTitle:"player-list"===v?(0,O.$)("players.player-list.title"):(0,O.$)("players.banned-list.title"),description:(0,O.$)("players.description"),category:(0,O.$)("sidebar.server"),icon:(0,r.jsx)(i.A,{}),className:"flex flex-col gap-3",children:[(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:(0,O.$)("players.hint")}),(0,r.jsxs)(h.tU,{value:v,onValueChange:e=>{g(e),(0,V.kz)("state.players.tab",e)},children:[(0,r.jsxs)("div",{className:"flex justify-between items-end max-lg:flex-col-reverse max-lg:items-start",children:[(0,r.jsxs)(h.j7,{children:[(0,r.jsx)(h.Xi,{value:"player-list",children:"".concat((0,O.$)("players.player-list.title")," (").concat(e.filter(e=>{let{isOnline:s}=e;return s}).length," / ").concat(x,")")}),(0,r.jsx)(h.Xi,{value:"banned-list",children:"".concat((0,O.$)("players.banned-list.title")," (").concat(e.filter(e=>{let{isBanned:s}=e;return s}).length,")")})]}),(0,r.jsxs)("div",{className:"min-w-fit border-b border-b-sidebar-border max-lg:border-b-transparent pb-1 flex gap-2 max-sm:flex-col max-sm:items-start *:cursor-pointer",children:[(0,r.jsx)(N.$,{variant:"ghost",title:(0,O.$)("players.action.refresh"),onClick:()=>B.P.emit("refresh-data"),children:(0,r.jsx)(n.A,{})}),(0,r.jsxs)(ee.MG,{children:[(0,r.jsx)(ee.Sq,{children:(0,r.jsx)(l.A,{})}),(0,r.jsx)(ee.iV,{value:$,placeholder:(0,O.$)("players.search.placeholder"),onChange:e=>b(e.target.value)})]}),(0,r.jsx)(ea,{asChild:!0,children:(0,r.jsxs)(N.$,{variant:"outline",children:[(0,r.jsx)(o.A,{}),(0,O.$)("players.banned-ips")]})}),f?(0,r.jsx)(Y.T,{onDisableWhitelist:()=>j(!1),asChild:!0,children:(0,r.jsxs)(N.$,{variant:"outline",children:[(0,r.jsx)(c.A,{}),(0,O.$)("players.edit-whitelist")]})}):(0,r.jsxs)(N.$,{variant:"outline",onClick:async()=>{await (0,L.lE)(!0),await A(),j(!0)},children:[(0,r.jsx)(d.A,{}),(0,O.$)("players.enable-whitelist")]})]})]}),(0,r.jsx)(h.av,{value:"player-list",children:(0,r.jsx)(p.b,{columns:X,data:[...k.filter(e=>{let{name:s,isOnline:t}=e;return s.toLowerCase().includes($.toLowerCase())&&t}),...k.filter(e=>{let{name:s,isOnline:t,isOp:r}=e;return s.toLowerCase().includes($.toLowerCase())&&!t&&r}),...k.filter(e=>{let{name:s,isOnline:t,isOp:r}=e;return s.toLowerCase().includes($.toLowerCase())&&!t&&!r}),...t],pagination:!0,fallbackMessage:(0,O.$)("players.empty")})}),(0,r.jsx)(h.av,{value:"banned-list",children:(0,r.jsx)(p.b,{columns:D,data:C.filter(e=>{let{name:s}=e;return s.toLowerCase().includes($.toLowerCase())}),pagination:!0,fallbackMessage:(0,O.$)("players.empty")})})]})]})}},95784:(e,s,t)=>{"use strict";t.d(s,{bq:()=>h,eb:()=>u,gC:()=>p,l6:()=>c,yv:()=>d});var r=t(95155);t(12115);var a=t(11031),i=t(66474),n=t(5196),l=t(47863),o=t(53999);function c(e){let{...s}=e;return(0,r.jsx)(a.bL,{"data-slot":"select",...s})}function d(e){let{...s}=e;return(0,r.jsx)(a.WT,{"data-slot":"select-value",...s})}function h(e){let{className:s,size:t="default",children:n,...l}=e;return(0,r.jsxs)(a.l9,{"data-slot":"select-trigger","data-size":t,className:(0,o.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...l,children:[n,(0,r.jsx)(a.In,{asChild:!0,children:(0,r.jsx)(i.A,{className:"size-4 opacity-50"})})]})}function p(e){let{className:s,children:t,position:i="popper",...n}=e;return(0,r.jsx)(a.ZL,{children:(0,r.jsxs)(a.UC,{"data-slot":"select-content",className:(0,o.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:i,...n,children:[(0,r.jsx)(m,{}),(0,r.jsx)(a.LM,{className:(0,o.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:t}),(0,r.jsx)(x,{})]})})}function u(e){let{className:s,children:t,...i}=e;return(0,r.jsxs)(a.q7,{"data-slot":"select-item",className:(0,o.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",s),...i,children:[(0,r.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,r.jsx)(a.VF,{children:(0,r.jsx)(n.A,{className:"size-4"})})}),(0,r.jsx)(a.p4,{children:t})]})}function m(e){let{className:s,...t}=e;return(0,r.jsx)(a.PP,{"data-slot":"select-scroll-up-button",className:(0,o.cn)("flex cursor-default items-center justify-center py-1",s),...t,children:(0,r.jsx)(l.A,{className:"size-4"})})}function x(e){let{className:s,...t}=e;return(0,r.jsx)(a.wn,{"data-slot":"select-scroll-down-button",className:(0,o.cn)("flex cursor-default items-center justify-center py-1",s),...t,children:(0,r.jsx)(i.A,{className:"size-4"})})}}},e=>{e.O(0,[9690,4390,1210,1835,9641,5702,6671,9438,297,4028,3448,5600,1462,3198,3102,8934,304,5294,7410,3395,8441,5964,7358],()=>e(e.s=53571)),_N_E=e.O()}]);